{"version":3,"file":"module-BSgVl7wC.cjs.js","sources":["../../src/module.ts"],"sourcesContent":["import { createBackendModule } from '@backstage/backend-plugin-api';\nimport { microsoftGraphOrgEntityProviderTransformExtensionPoint } from '@backstage/plugin-catalog-backend-module-msgraph/alpha';\n\nimport { UserEntity } from '@backstage/catalog-model';\nimport * as MicrosoftGraph from '@microsoft/microsoft-graph-types';\n\nconst MICROSOFT_GRAPH_USER_ID_ANNOTATION = 'graph.microsoft.com/user-id';\n\nexport async function myUserTransformer(\n  user: MicrosoftGraph.User,\n  userPhoto?: string,\n): Promise<UserEntity | undefined> {\n  if (!user.id || !user.displayName || !user.userPrincipalName) {\n    return void 0;\n  }\n  const name = normalizeUserPrincipalName(user.userPrincipalName);\n  const entity: UserEntity = {\n    apiVersion: 'backstage.io/v1alpha1',\n    kind: 'User',\n    metadata: {\n      name,\n      annotations: {\n        [MICROSOFT_GRAPH_USER_ID_ANNOTATION]: user.id!,\n      },\n    },\n    spec: {\n      profile: {\n        displayName: user.displayName,\n      },\n      memberOf: [],\n    },\n  };\n  if (user.mail) entity.spec.profile!.email = user.mail;\n  if (userPhoto) entity.spec.profile!.picture = userPhoto;\n  return entity;\n}\n\nexport function normalizeUserPrincipalName(name: string): string {\n  return name\n    .trim()\n    .replace('@ford.com','')\n    .toLocaleUpperCase();\n}\n\nexport const catalogModuleMsGraphTransformer = createBackendModule({\n  pluginId: 'catalog',\n  moduleId: 'ms-graph-transformer',\n  register(env) {\n    env.registerInit({\n      deps: {\n        microsoftGraphTransformers:\n          microsoftGraphOrgEntityProviderTransformExtensionPoint,\n      },\n      async init({ microsoftGraphTransformers }) {\n        microsoftGraphTransformers.setUserTransformer(myUserTransformer);\n      },\n    });\n  },\n});"],"names":["createBackendModule","microsoftGraphOrgEntityProviderTransformExtensionPoint"],"mappings":";;;;;AAMA,MAAM,kCAAqC,GAAA,6BAAA,CAAA;AAErB,eAAA,iBAAA,CACpB,MACA,SACiC,EAAA;AACjC,EAAI,IAAA,CAAC,KAAK,EAAM,IAAA,CAAC,KAAK,WAAe,IAAA,CAAC,KAAK,iBAAmB,EAAA;AAC5D,IAAO,OAAA,KAAA,CAAA,CAAA;AAAA,GACT;AACA,EAAM,MAAA,IAAA,GAAO,0BAA2B,CAAA,IAAA,CAAK,iBAAiB,CAAA,CAAA;AAC9D,EAAA,MAAM,MAAqB,GAAA;AAAA,IACzB,UAAY,EAAA,uBAAA;AAAA,IACZ,IAAM,EAAA,MAAA;AAAA,IACN,QAAU,EAAA;AAAA,MACR,IAAA;AAAA,MACA,WAAa,EAAA;AAAA,QACX,CAAC,kCAAkC,GAAG,IAAK,CAAA,EAAA;AAAA,OAC7C;AAAA,KACF;AAAA,IACA,IAAM,EAAA;AAAA,MACJ,OAAS,EAAA;AAAA,QACP,aAAa,IAAK,CAAA,WAAA;AAAA,OACpB;AAAA,MACA,UAAU,EAAC;AAAA,KACb;AAAA,GACF,CAAA;AACA,EAAA,IAAI,KAAK,IAAM,EAAA,MAAA,CAAO,IAAK,CAAA,OAAA,CAAS,QAAQ,IAAK,CAAA,IAAA,CAAA;AACjD,EAAA,IAAI,SAAW,EAAA,MAAA,CAAO,IAAK,CAAA,OAAA,CAAS,OAAU,GAAA,SAAA,CAAA;AAC9C,EAAO,OAAA,MAAA,CAAA;AACT,CAAA;AAEO,SAAS,2BAA2B,IAAsB,EAAA;AAC/D,EAAA,OAAO,KACJ,IAAK,EAAA,CACL,QAAQ,WAAY,EAAA,EAAE,EACtB,iBAAkB,EAAA,CAAA;AACvB,CAAA;AAEO,MAAM,kCAAkCA,oCAAoB,CAAA;AAAA,EACjE,QAAU,EAAA,SAAA;AAAA,EACV,QAAU,EAAA,sBAAA;AAAA,EACV,SAAS,GAAK,EAAA;AACZ,IAAA,GAAA,CAAI,YAAa,CAAA;AAAA,MACf,IAAM,EAAA;AAAA,QACJ,0BACE,EAAAC,4DAAA;AAAA,OACJ;AAAA,MACA,MAAM,IAAA,CAAK,EAAE,0BAAA,EAA8B,EAAA;AACzC,QAAA,0BAAA,CAA2B,mBAAmB,iBAAiB,CAAA,CAAA;AAAA,OACjE;AAAA,KACD,CAAA,CAAA;AAAA,GACH;AACF,CAAC;;;;"}